<div class="profile-section">
    <div class="profile-header">
      <div class="profile-picture">
        <% if current_user.profile_photo.attached? %>
          <%= image_tag(current_user.profile_photo.variant(resize_to_limit: [100, 100]).processed,class:"profile-image") %>
          <% else %>
            <%= image_tag("profile.png", class: "profile-image") %>
        <% end %>
      </div>
      <div class="profile-details">
        <div class="profile-name-email">
          <h2 class="profile-name"><%= "#{@user.first_name} #{@user.last_name}" %></h2>

        <div class="tabs">
          <button class="tab star-tab" id=" tab star-tab"onclick="toggleTab('reviews')"> <span class="stars" style="color: #007883">★★★★★</span> <span class="rating-stars">(4)</span>
          </button>
          </div>

        </div>
        <div class="profile-actions">
          <%= link_to edit_user_registration_path, class: 'btn' do %>
            <%= image_tag "editing.png", class: "profile-icon" %>
          <% end %>
          <%= link_to destroy_user_session_path, data: { turbo_method: :delete }, class: 'btn' do %>
            <%= image_tag "log-out.png", class: "profile-icon" %>
          <% end %>
        </div>
      </div>
    </div>
  </div>

  <div class="tabs">
  <button class="tab" onclick="toggleTab('products')">Products</button>
  <button class="tab" onclick="toggleTab('reviews')">Reviews</button>
  </div>


<div class="tab-content" id="productsTab">
    <div class="products-grid">
      <% @products.each do |product| %>
        <%= link_to product_path(product), class: 'product-link' do %>
          <div class="product-card">
            <%= image_tag(product.image, class: 'product-image') if product.image.attached? %>
            <div class="product-info">
              <span class="price">€<%= product.price_per_day.to_i == product.price_per_day ? product.price_per_day.to_i : product.price_per_day %></span>
              <p class="title"><%= product.title %></p>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
  </div>


<div class="tab-content" id="reviewsTab">
  <% product_ratings = @reviews.select { |review| review.review_type == 'product' && review.product_rating.present? && review.booking.present? && review.booking.product.user == current_user }.map(&:product_rating) %>
  <% booking_ratings = @reviews.select { |review| review.review_type == 'booking' && review.booking_rating.present? && review.booking.user == current_user }.map(&:booking_rating) %>

  <% overall_ratings = product_ratings + booking_ratings %>
  <% @average_rating = overall_ratings.present? ? overall_ratings.sum.to_f / overall_ratings.size : nil %>

  <div class="reviews-container">
    <h2>Overall User Rating: <%= '★' * (@average_rating || 0) %> (<%= @average_rating || 0 %>)</h2>

    <% @reviews.each do |review| %>
      <% unless review.booking.user == current_user %>
        <!-- Display product rating and content -->
        <% if review.review_type == 'product' && review.product_rating.present? && review.booking.present? && review.booking.product.user == current_user %>
          <h3>Product Rating</h3>
          <h5>Rating</h5>
          <%= review.product_rating %>
          <h5>Content</h5>
          <%= review.product_content %>
        <% end %>
      <% end %>

      <!-- Display booking rating and content -->
      <h3>Booking Rating</h3>
      <h5>Rating</h5>
      <%= review.booking_rating %>
      <h5>Content</h5>
      <%= review.booking_content %>
    <% end %>
  </div>
</div>



<script>
  function toggleTab(tabName) {
    document.querySelectorAll('.tab-content').forEach(tab => {
      tab.style.display = 'none';
    });

    document.querySelectorAll('.tab').forEach(tab => {
      tab.classList.remove('active');
    });

    document.getElementById(`${tabName}Tab`).style.display = 'block';
    document.querySelector(`.tab.${tabName}`).classList.add('active');
  }

  toggleTab('products');
</script>
