<section id="content" class="product-show-container">
  <div class="product-card">
    <div class="product-image-wrapper">
      <%= image_tag(@product.image, class: 'product-image') if @product.image.attached? %>
    </div>

    <div class="product-details">
      <div class="product-info">
        <div class="icons-row">
          <% if user_signed_in? && current_user != @product.user %>

            <%= link_to product_reviews_index_path(@product), id: "btn-products", class: "tab-btn active" do %>
              <span class="stars">★★★★★</span>
              <span class="rating-stars">(4)</span>
            <% end %>

            <% if @product.favorited_by_user?(current_user) && current_user != @product.user%>
              <%= link_to toggle_favorite_product_path(@product), method: :post, class: 'product-icon-filled' do %>
                <%= image_tag 'likeGOOD.png' %>
              <% end %>
            <% else%>
              <%= link_to toggle_favorite_product_path(@product), method: :post, class: 'product-icon' do %>
                <%= image_tag 'likeGOODnot.png' %>
              <% end %>
            <% end %>
            <button class="btn-chat user-btn">Chat</button>
            <%= link_to @product.user.name_with_initial, profile_path(@product.user), class: "btn btn-primary user-btn" %>
          <% elsif  !user_signed_in? %>

            <%= link_to new_user_session_path, id: "btn-products", class: "tab-btn active" do %>
              <span class="stars">★★★★★</span>
              <span class="rating-stars">(4)</span>
            <% end %>

            <div class="product-icon">
              <%= link_to new_user_session_path, method: :post do %>
                <%= image_tag 'like.png' %>
              <% end %>
              <%= link_to new_user_session_path do %>
                <button class="btn-chat user-btn">Chat</button>
              <% end %>
              <%= link_to @product.user.name_with_initial + '.', profile_path(@product.user), class: "btn btn-primary user-btn" %>
            </div>
          <% end %>
        </div>

        <h1 class="product-title"><%= @product.title %></h1>
        <span class="product-condition"><%= @product.condition %></span>
        <span class="product-category"><%= @product.category.name %></span>
        <p class="product-description"><%= @product.description %></p>
        <strong><span class="product-price"><%= number_to_currency(@product.price_per_day, unit: '', format: "%n€") %>/day</span></strong>
      </div>

      <%= image_tag('address.png', id: 'map-trigger', class: "image-address", style: "width: 33px; height: 33px; margin: 0;") %>
      <div class="map-container"
          data-controller="map"
          data-map-markers-value="<%= [{ lat: @product.user.latitude, lng: @product.user.longitude }].to_json %>"
          data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
      </div>

      <div class=under-container>
        <div class="product-buttons-container">
          <% if current_user == @product.user %>
            <div class="btn-edit">
              <%= link_to edit_product_path(@product), class: 'btn btn-outline-secondary' do %>
                Edit Product
              <% end %>
            </div>
            <div class="btn-delete">
              <%= link_to @product, data: { turbo_method: "delete", turbo_confirm: 'Are you sure you want to delete this product?'}, class: 'btn btn-outline-secondary', id: 'delete-product' do %>
                Delete Product
              <% end %>
            </div>
          <% else %>
            <%= render "book_product_form" %>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</section>
